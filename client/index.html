<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1"
    />
    <title>DecA(I)de - DECA Practice Platform</title>
    <!-- Vanta.js Dependencies - Updated to latest versions -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.1/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@0.5.24/dist/vanta.waves.min.js"></script>
    <style>
      /* Ensure the Vanta background covers all white/blank areas */
      #vanta-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -100;
        pointer-events: none;
      }
      
      /* Higher z-index to ensure it's visible on all pages */
      body {
        position: relative;
        overflow-x: hidden;
      }
    </style>
  </head>
  <body>
    <!-- Background element for Vanta (outside of React) -->
    <div id="vanta-bg"></div>
    <div id="root"></div>
    
    <!-- Initialize Vanta waves effect with more reliable initialization -->
    <script>
      (function() {
        // Declare the effect
        let vantaEffect = null;
        
        // Simplified function to check if dark mode is active
        function isDarkModeEnabled() {
          return document.documentElement.classList.contains('dark');
        }
        
        // Initialize or reinitialize the Vanta effect
        function setupVantaBackground() {
          // Get the dark mode state
          const isDarkMode = isDarkModeEnabled();
          
          // Destroy previous effect if it exists
          if (vantaEffect) {
            vantaEffect.destroy();
          }
          
          console.log('Initializing Vanta with dark mode:', isDarkMode);
          
          // Setup the effect with the appropriate color
          vantaEffect = VANTA.WAVES({
            el: "#vanta-bg",  // This targets the div we created
            THREE: THREE,     // Pass THREE explicitly to avoid issues
            mouseControls: true,
            touchControls: true,
            gyroControls: false,
            minHeight: 200.00,
            minWidth: 200.00,
            scale: 1.00,
            scaleMobile: 1.00,
            color: isDarkMode ? 0x292929 : 0xa2a2a7,  // Different colors for dark/light modes
            shininess: 0.00,
            waveHeight: 28.00,
            waveSpeed: 1.50,
            zoom: 0.65
          });
        }
        
        // Wait for DOM to be ready before initializing
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', setupVantaBackground);
        } else {
          setupVantaBackground();
        }
        
        // Listen for theme changes - both from our custom event and DOM changes
        window.addEventListener('theme-change', function(e) {
          console.log('Theme change event detected:', e.detail);
          setupVantaBackground();
        });
        
        // Observer for class changes on the html element (for dark mode toggle)
        const observer = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            if (mutation.attributeName === 'class') {
              console.log('Class mutation detected, dark mode:', isDarkModeEnabled());
              setupVantaBackground();
            }
          });
        });
        
        // Start observing
        observer.observe(document.documentElement, { 
          attributes: true,
          attributeFilter: ['class']
        });
      })();
    </script>
    
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
